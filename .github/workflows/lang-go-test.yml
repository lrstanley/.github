# USAGE:
#   jobs:
#     go-version:
#       uses: lrstanley/.github/.github/workflows/lang-go-latest-version.yml@master
#     go-test:
#       needs: [go-version]
#       uses: lrstanley/.github/.github/workflows/lang-go-test.yml@master
#       with:
#         go-version: ${{ needs.go-version.outputs.version }}

name: go-test

on:
  workflow_call:
    inputs:
      go-version:
        required: true
        type: string

jobs:
  go-test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/setup-go@v3
        with: { go-version: "${{ inputs.go-version }}" }
      - uses: actions/checkout@v3
      - run: |
          GORACE="exitcode=1 halt_on_error=1" go test -v -race -timeout 3m -count 3 -cpu 1,4
