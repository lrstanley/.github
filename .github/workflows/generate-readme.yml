name: generate-readme

on: [workflow_call]

jobs:
  lint:
    runs-on: ubuntu-latest
    permissions:
      packages: read
      actions: read

    steps:
      - uses: actions/checkout@v3
        with:
          ref: ${{ github.event.repository.default_branch || 'master' }}
      - name: git-clone-tools-repo
        uses: actions/checkout@v3
        with:
          path: ghmeta
          repository: lrstanley/.github
      - name: generate
        run: |
          cp -av README.md{,.bak}
          find "$PWD" ! -path "**/ghmeta/**" -type f -name "*.md" -exec ./ghmeta/readme/run.sh "{}" \;
          diff -up README.md{,.bak}
