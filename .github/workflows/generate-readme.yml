name: generate-readme

on: [workflow_call]

jobs:
  generate:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      packages: read
      actions: read

    steps:
      - uses: actions/checkout@v3
        with:
          ref: ${{ github.event.repository.default_branch || 'master' }}
      - name: git-clone-tools-repo
        uses: actions/checkout@v3
        with:
          path: ghmeta
          repository: lrstanley/.github
      - name: generate
        continue-on-error: true
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          set -e
          ./ghmeta/readme/run.sh README.md
          git config user.name "github-actions"
          git config user.email "github-actions@github.com"
          git add README.md
          git commit -m "docs(readme): auto-update [skip ci]"
          git push
